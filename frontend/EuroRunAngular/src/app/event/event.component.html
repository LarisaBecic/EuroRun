<div class="event-container" *ngIf="loadedEvent">
  <div class="event-header">
    <h1>{{ loadedEvent.name }}</h1>
    <p class="date">{{ loadedEvent.dateTime | date:'fullDate' }}</p>
  </div>

  <div class="event-image" *ngIf="loadedEvent.picture">
    <img [src]="'data:image/jpeg;base64,' + loadedEvent.picture" alt="Event Image" (click)="openZoom(loadedEvent.picture)"
      class="clickable-image">
  </div>

  <div class="zoom-overlay" *ngIf="zoomImage" (mousedown)="startPan($event)" (mousemove)="onPan($event)"
    (mouseup)="stopPan()" (mouseleave)="stopPan()" (click)="closeZoom()" (wheel)="onWheel($event)">
    <img class="zoomed-image" [src]="'data:image/jpeg;base64,' + zoomImage" (click)="$event.stopPropagation()"
      [style.transform]="transformStyle">
  </div>


  <div class="event-info">
    <p class="description">{{ loadedEvent.description }}</p>
    <div class="location">
      üìç {{ loadedEvent.location.name }} ‚Äì {{ loadedEvent.location.city.name }} ‚Äì {{ loadedEvent.location.city.country.name }}
    </div>
    <div class="event-type">
      üè∑Ô∏è {{ loadedEvent.eventType.name }}
    </div>
    <div class="entryFee">
      üíµ ‚Ç¨{{ loadedEvent.entryFee }}
    </div>
    <div class="fav-div" (click)="$event.stopPropagation()">
      <mat-icon class="heart-icon" (click)="toggleFavourite($event)">
        {{ loadedEvent.userFavourite ? 'favorite' : 'favorite_border' }}
      </mat-icon>

      <span class="fav-count">{{ loadedEvent.favouritedTimes }}</span>
    </div>

  </div>

  <button class="btn-primary register-btn"
    *ngIf="loginInfo?.isLoggedIn && loginInfo?.authentificationToken?.userAccount?.role?.name == 'User'"
    (click)="openWizard()">
    Register for Event
  </button>

  <div class="wizard-backdrop" *ngIf="showWizard">
    <div class="wizard-card">

      <div class="wizard-step">
        Step {{ wizardStep }}/3
      </div>

      <div class="wizard-content">

        <div *ngIf="wizardStep === 1">
          <h2>Your Details</h2>

          <input [(ngModel)]="firstName" placeholder="First Name">
          <input [(ngModel)]="lastName" placeholder="Last Name">
          <input [(ngModel)]="email" placeholder="Email">
          <input [(ngModel)]="phoneNumber" placeholder="Phone">

          <select [(ngModel)]="gender_id">
            <option *ngFor="let g of genders" [ngValue]="g.id">
              {{ g.name }}
            </option>
          </select>

          <div class="wizard-actions">
            <button class="btn-text" (click)="closeWizard()">Cancel</button>
            <button class="btn-primary" (click)="updateUser()">Update Details</button>
            <button class="btn-primary" (click)="goToStep(2)">Next</button>
          </div>
        </div>

        <div *ngIf="wizardStep === 2">
          <h2>Registration Info</h2>

          <input [(ngModel)]="club" placeholder="Club">
          <input [(ngModel)]="shirtSize" placeholder="Shirt Size">
          <input type="number" [(ngModel)]="numberOfFinishedRaces" placeholder="Finished Races">
          <input [(ngModel)]="eventDiscoverySource" placeholder="How did you hear about this event?">
          <textarea [(ngModel)]="note" placeholder="Health notes / comments"></textarea>

          <div class="wizard-actions">
            <button class="btn-text" (click)="closeWizard()">Cancel</button>
            <button class="btn-text" (click)="goToStep(1)">Back</button>
            <button class="btn-primary" (click)="goToStep(3)">Next</button>
          </div>
        </div>

        <div *ngIf="wizardStep === 3">
          <h2>Confirm Registration</h2>

          <p><b>Name:</b> {{ firstName }} {{ lastName }}</p>
          <p><b>Email:</b> {{ email }}</p>
          <p><b>Event:</b> {{ loadedEvent.name }}</p>
          <p><b>Date:</b> {{ loadedEvent.dateTime | date:'fullDate' }}</p>
          <p><b>Location:</b> {{ loadedEvent.location.name }} ‚Äì {{ loadedEvent.location.city.name }} ‚Äì {{
            loadedEvent.location.city.country.name }}</p>
          <p><b>Entry Fee:</b> ‚Ç¨{{ loadedEvent.entryFee }}</p>
          <p><b>Club:</b> {{ club }}</p>
          <p><b>Shirt Size:</b> {{ shirtSize }}</p>
          <p><b>Finished Races:</b> {{ numberOfFinishedRaces }}</p>
          <p><b>Notes:</b> {{ note }}</p>

          <form (submit)="handleSubmit($event, loadedEvent)">
            <div #cardContainer id="card-element"></div>
            <div class="wizard-actions">
            <button class="btn-text" (click)="closeWizard()">Cancel</button>
            <button class="btn-text" (click)="goToStep(2)">Back</button>
            <button lass="btn-primary" type="submit">Confirm and Pay</button>
            <!--<button class="btn-primary" (click)="addEventRegistration()">Confirm</button>-->
          </div>
          </form>
        </div>

      </div>
    </div>
  </div>

</div>